# クライアント連絡ツールURL機能 仕様書

## 概要

各クライアントに連絡ツール（LINE、Messenger、ChatWork等）のURLを設定し、報告書生成後にワンクリックで該当ツールを開いて報告できるようにする機能。

## 目的

- 報告書生成から連絡までのワークフローを効率化
- クライアントごとの連絡先を一元管理
- 連絡漏れの防止

## 対応する連絡ツール

| ツール | URL形式例 |
|--------|-----------|
| LINE | `https://line.me/R/oaMessage/{アカウントID}` |
| Messenger | `https://m.me/{ページID}` |
| ChatWork | `https://www.chatwork.com/#!rid{ルームID}` |
| Slack | `https://app.slack.com/client/{ワークスペース}/{チャンネル}` |
| Teams | `https://teams.microsoft.com/l/chat/...` |
| メール | `mailto:{メールアドレス}` |
| その他 | 任意のURL |

## データベース設計

### Clientモデルへの追加フィールド

```prisma
model Client {
  id             String   @id @default(cuid())
  organizationId String
  organization   Organization @relation(fields: [organizationId], references: [id], onDelete: Cascade)
  name           String
  description    String?
  color          String?
  zoomUrl        String?  // 既存
  contactUrl     String?  // 追加: 連絡ツールURL
  contactType    String?  // 追加: ツール種別（line, messenger, chatwork, slack, teams, email, other）
  isActive       Boolean  @default(true)
  createdAt      DateTime @default(now())
  updatedAt      DateTime @updatedAt

  @@unique([organizationId, name])
  @@index([organizationId])
}
```

## UI設計

### 1. クライアント編集画面

クライアント情報の編集時に連絡ツールURLを設定できるようにする。

```
┌─────────────────────────────────────────────────────┐
│ クライアントを編集                              [×] │
├─────────────────────────────────────────────────────┤
│                                                     │
│ クライアント名 *                                    │
│ ┌─────────────────────────────────────────────────┐│
│ │ サンプル株式会社                                ││
│ └─────────────────────────────────────────────────┘│
│                                                     │
│ 説明                                                │
│ ┌─────────────────────────────────────────────────┐│
│ │ 主要クライアント                                ││
│ └─────────────────────────────────────────────────┘│
│                                                     │
│ 連絡ツール                                          │
│ ┌──────────────┐                                   │
│ │ ChatWork  ▼  │                                   │
│ └──────────────┘                                   │
│                                                     │
│ 連絡先URL                                           │
│ ┌─────────────────────────────────────────────────┐│
│ │ https://www.chatwork.com/#!rid123456789        ││
│ └─────────────────────────────────────────────────┘│
│ ※ 報告書生成後にこのURLを開いて報告できます        │
│                                                     │
├─────────────────────────────────────────────────────┤
│                      [キャンセル] [保存]            │
└─────────────────────────────────────────────────────┘
```

### 2. 報告書生成モーダル（更新）

報告書生成後、連絡ツールへのリンクボタンを表示する。

```
┌─────────────────────────────────────────────────────┐
│ クライアント報告書を生成                        [×] │
├─────────────────────────────────────────────────────┤
│ サンプル株式会社様 定例MTG • 2024/1/15              │
│                                                     │
│ テンプレート                                        │
│ ┌─────────────────────────────────────────────────┐│
│ │ 標準報告テンプレート (デフォルト)           ▼  ││
│ └─────────────────────────────────────────────────┘│
│                                                     │
│ 生成結果                              [コピー]      │
│ ┌─────────────────────────────────────────────────┐│
│ │ 【MTG報告】サンプル株式会社様 2024年1月15日     ││
│ │                                                 ││
│ │ ■ 概要                                         ││
│ │ プロジェクトの進捗確認を行いました...           ││
│ │ ...                                             ││
│ └─────────────────────────────────────────────────┘│
│                                                     │
├─────────────────────────────────────────────────────┤
│ [ChatWorkで報告]          [再生成] [閉じる]         │
│  ↑ 連絡ツールが設定されている場合に表示            │
└─────────────────────────────────────────────────────┘
```

### 3. クライアント一覧画面

連絡ツールアイコンを表示し、設定状況を可視化。

```
┌────────────────────────────────────────────────────────────────┐
│ クライアント                                      [+ 新規作成] │
├────────────────────────────────────────────────────────────────┤
│                                                                │
│ ┌────────────────────────────────────────────────────────────┐│
│ │ サンプル株式会社                   📊 5件  ⏱ 300分         ││
│ │ 主要クライアント                                           ││
│ │ 最終MTG: 2024/1/15            [💬ChatWork] [✏️] [🗑]       ││
│ └────────────────────────────────────────────────────────────┘│
│                                                                │
│ ┌────────────────────────────────────────────────────────────┐│
│ │ テスト商事                         📊 3件  ⏱ 180分         ││
│ │                                                             ││
│ │ 最終MTG: 2024/1/10            [📧メール] [✏️] [🗑]          ││
│ └────────────────────────────────────────────────────────────┘│
│                                                                │
└────────────────────────────────────────────────────────────────┘
```

## 連絡ツールアイコン

| ツール種別 | アイコン | 色 |
|-----------|---------|-----|
| line | MessageCircle | #00B900 |
| messenger | MessageCircle | #0084FF |
| chatwork | MessageSquare | #FF4B00 |
| slack | Hash | #4A154B |
| teams | Users | #6264A7 |
| email | Mail | #EA4335 |
| other | ExternalLink | #6B7280 |

## API設計

### 1. クライアント更新API（既存を拡張）

**PUT /api/clients**

```typescript
// リクエスト
{
  id: string;
  name?: string;
  description?: string;
  color?: string;
  zoomUrl?: string;
  contactUrl?: string;    // 追加
  contactType?: string;   // 追加
  isActive?: boolean;
}

// レスポンス
{
  success: boolean;
  client: Client;
}
```

### 2. クライアント作成API（既存を拡張）

**POST /api/clients**

```typescript
// リクエスト
{
  name: string;
  description?: string;
  color?: string;
  zoomUrl?: string;
  contactUrl?: string;    // 追加
  contactType?: string;   // 追加
}
```

## ワークフロー

```
1. クライアント登録/編集
   └─> 連絡ツールURLを設定

2. 録画処理完了
   └─> 要約生成

3. 報告書生成
   └─> テンプレート選択
   └─> 報告書生成
   └─> 「コピー」ボタンで報告書をコピー

4. 連絡ツールで報告
   └─> 「ChatWorkで報告」等のボタンをクリック
   └─> 連絡ツールが新しいタブで開く
   └─> コピーした報告書を貼り付けて送信
```

## 実装タスク

1. [ ] Prismaスキーマ更新（contactUrl, contactType追加）
2. [ ] クライアントAPI更新（作成・更新）
3. [ ] クライアント編集UI更新
4. [ ] クライアント一覧UI更新（アイコン表示）
5. [ ] 報告書生成モーダル更新（連絡ボタン追加）
6. [ ] 本番環境にデプロイ

## 将来の拡張案

- 報告書を自動でクリップボードにコピーしてから連絡ツールを開く
- ChatWork APIを使った自動投稿機能
- LINE Notify連携
- Slack Webhook連携
