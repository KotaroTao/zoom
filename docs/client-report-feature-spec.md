# クライアント向け議事録生成機能 仕様書

## 1. 概要

### 1.1 目的
ミーティング録画から、クライアントに送付可能な形式の議事録・報告文書を自動生成する機能を実装する。

### 1.2 背景
現在、録画の要約は生成されているが、クライアントへ送付するためには手動でフォーマットを整える必要がある。この作業を自動化し、ワンクリックでコピー可能な形式で出力する。

---

## 2. 機能要件

### 2.1 出力フォーマット

```
本日のミーティングありがとうございました。

下記、本日の議事録＆動画となります。
引き続き、よろしくお願いいたします。

{日付} {時刻}

## 概要
{ミーティングの概要・参加者・目的}

## 主な議論
- {議論ポイント1}
- {議論ポイント2}
- ...

## 決定事項
- {決定事項1}
- {決定事項2}
- ...

## アクションアイテム
- [ ] {タスク1}（{担当者}、{期限}）
- [ ] {タスク2}（{担当者}、{期限}）
- ...

## 次のステップ
- {次のステップの説明}

ミーティング動画
{YouTube URL}
```

### 2.2 生成に必要なデータ

| データ | ソース | 必須/任意 |
|--------|--------|-----------|
| 日付・時刻 | `recording.meetingDate` | 必須 |
| 概要 | AI生成（文字起こしから） | 必須 |
| 主な議論 | AI生成（文字起こしから） | 必須 |
| 決定事項 | AI生成（文字起こしから） | 任意 |
| アクションアイテム | AI生成（文字起こしから） | 任意 |
| 次のステップ | AI生成（文字起こしから） | 任意 |
| YouTube URL | `recording.youtubeUrl` | 任意 |
| クライアント名 | `recording.clientName` | 任意 |

### 2.3 AI生成プロンプト

文字起こしテキストから構造化された議事録を生成するため、専用のプロンプトを使用：

```
以下のミーティング文字起こしから、クライアント向け議事録を生成してください。

出力形式（JSON）:
{
  "summary": "概要（参加者・目的・結論を含む1-2文）",
  "discussions": ["議論ポイント1", "議論ポイント2", ...],
  "decisions": ["決定事項1", "決定事項2", ...],
  "actionItems": [
    {"task": "タスク内容", "assignee": "担当者", "deadline": "期限"}
  ],
  "nextSteps": "次のステップの説明"
}
```

---

## 3. UI/UX設計

### 3.1 ダッシュボード - 録画詳細画面

**新規ボタン追加:**
- 「クライアント向け文書を生成」ボタン
- 既存の「要約」タブの隣、または録画カード内

**生成後の表示:**
- モーダルまたはサイドパネルで表示
- 「クリップボードにコピー」ボタン
- 「再生成」ボタン（必要に応じて）

### 3.2 ワイヤーフレーム

```
┌─────────────────────────────────────────────────────────┐
│ 録画詳細                                    [×]         │
├─────────────────────────────────────────────────────────┤
│ タイトル: AXiY for Dental 導入ミーティング              │
│ 日時: 2026/01/21 13:59                                  │
│ クライアント: ゆうデンタルオフィス                      │
│ 状態: ✅ 完了                                           │
├─────────────────────────────────────────────────────────┤
│ [文字起こし] [要約] [クライアント報告] [YouTube]        │
├─────────────────────────────────────────────────────────┤
│                                                         │
│  ┌─────────────────────────────────────────────────┐   │
│  │ 本日のミーティングありがとうございました。       │   │
│  │                                                   │   │
│  │ 下記、本日の議事録＆動画となります。             │   │
│  │ 引き続き、よろしくお願いいたします。             │   │
│  │                                                   │   │
│  │ 2026年1月21日 13:59                               │   │
│  │                                                   │   │
│  │ ## 概要                                           │   │
│  │ AXiY for Dentalの導入に関するミーティングで...   │   │
│  │ ...                                               │   │
│  └─────────────────────────────────────────────────┘   │
│                                                         │
│  [📋 クリップボードにコピー]  [🔄 再生成]              │
│                                                         │
└─────────────────────────────────────────────────────────┘
```

### 3.3 録画一覧でのアクセス

録画カードに「📋」アイコンを追加し、クイックコピー機能を提供：
- アイコンクリックで即座にクライアント報告をクリップボードにコピー
- 未生成の場合は生成後にコピー

---

## 4. データモデル

### 4.1 Recordingテーブル拡張

```prisma
model Recording {
  // 既存フィールド
  id              String   @id
  title           String
  transcript      String?  // 文字起こし
  summary         String?  // 既存の要約

  // 新規フィールド
  clientReport    String?  // クライアント向け議事録（Markdown形式）
  clientReportGeneratedAt DateTime?  // 生成日時
}
```

### 4.2 生成データの保存形式

クライアント報告は完成形のMarkdown文字列として保存。
再生成時は上書き更新。

---

## 5. API設計

### 5.1 クライアント報告生成

**エンドポイント:** `POST /api/recordings/{id}/client-report`

**リクエスト:**
```json
{
  "regenerate": false  // trueの場合、既存を上書き再生成
}
```

**レスポンス:**
```json
{
  "success": true,
  "clientReport": "本日のミーティング...",
  "generatedAt": "2026-01-21T14:00:00Z"
}
```

### 5.2 クライアント報告取得

**エンドポイント:** `GET /api/recordings/{id}/client-report`

**レスポンス:**
```json
{
  "clientReport": "本日のミーティング...",
  "generatedAt": "2026-01-21T14:00:00Z",
  "exists": true
}
```

---

## 6. 処理フロー

### 6.1 自動生成フロー（推奨）

```
録画完了
    ↓
文字起こし完了
    ↓
要約生成（既存）
    ↓
クライアント報告生成（新規）← ここで自動実行
    ↓
YouTubeアップロード完了
    ↓
完了通知
```

### 6.2 手動生成フロー

```
ダッシュボードで録画を選択
    ↓
「クライアント報告」タブをクリック
    ↓
未生成の場合: 「生成」ボタンをクリック
    ↓
AI生成処理（5-10秒）
    ↓
結果表示
    ↓
「コピー」ボタンでクリップボードにコピー
```

---

## 7. テンプレートのカスタマイズ

### 7.1 組織別テンプレート設定

将来的に、組織ごとにテンプレートをカスタマイズ可能にする：

```prisma
model Organization {
  // 既存フィールド

  // 新規フィールド
  clientReportTemplate String?  // カスタムテンプレート
  clientReportGreeting String?  // 挨拶文のカスタマイズ
}
```

### 7.2 デフォルトテンプレート変数

| 変数 | 説明 |
|------|------|
| `{date}` | ミーティング日付 |
| `{time}` | ミーティング時刻 |
| `{clientName}` | クライアント名 |
| `{summary}` | 概要 |
| `{discussions}` | 主な議論（箇条書き） |
| `{decisions}` | 決定事項（箇条書き） |
| `{actionItems}` | アクションアイテム（チェックリスト） |
| `{nextSteps}` | 次のステップ |
| `{youtubeUrl}` | YouTube URL |

---

## 8. 実装計画

### Phase 1: 基本機能
- [ ] Prismaスキーマ更新（clientReportフィールド追加）
- [ ] クライアント報告生成API実装
- [ ] AI生成プロンプト作成・調整
- [ ] ダッシュボードUI実装（タブ追加、コピーボタン）

### Phase 2: 自動化
- [ ] 要約生成後に自動でクライアント報告も生成
- [ ] 録画一覧でのクイックコピー機能

### Phase 3: カスタマイズ
- [ ] 組織別テンプレート設定
- [ ] 挨拶文のカスタマイズ機能

---

## 9. 考慮事項

### 9.1 エラーハンドリング

- 文字起こしが未完了の場合: 「文字起こしが完了してから生成できます」
- YouTube未アップロードの場合: URL部分を省略または「準備中」と表示
- AI生成失敗時: リトライボタンを表示

### 9.2 パフォーマンス

- 生成は非同期で実行（ユーザーは待機不要）
- 生成済みの場合はキャッシュから即座に返却
- 長い文字起こしは要約を使用して生成（トークン節約）

### 9.3 セキュリティ

- クライアント報告は録画と同じアクセス権限で保護
- 組織外からのアクセス不可

---

## 10. 成功指標

- クライアント報告のコピー回数
- 手動編集なしでそのまま使用された割合
- 生成から送信までの時間短縮

---

## 11. 備考

この仕様書は初期バージョンです。実装中に発生した課題や追加要件に応じて更新します。
